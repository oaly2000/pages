---
title: 滥用的令牌
date: 2024-04-13
tags:
    - Authorization
---

几天前, 网友在用`NestJS`改造旧的应用, 顺便就用上了`JWT`, 我还叭叭搁那出谋划策呢, 然而经过具体了解(长时间的无效沟通),
终于我发现他的应用并不适合使用 JWT 方案.那么来讨论下为何他的应用不适合使用 JWT 方案

1. JWT 一个显著特征是无状态, 不使用白名单, 顶多用黑名单来实现撤销. 而网友的应用需要限制登录设备,
   在无白名单的情况下是没有办法得知登录设备信息的.
2. 网友的权限系统是动态策略, 即权限列表固定, 上层策略和用户关联存库可修改, 那么就要求用户的策略修改后, 原有登录也能用上最新的权限, 然而 JWT
   是典型的值令牌, 在 JWT 认证中, 常见的做法是从令牌的 JSON 数据中取用户 ID 和各种权限相关信息比如权限列表,策略和角色,
   也就是说这些信息是存在令牌上的, 不查库. 问题就在这个不查库上, 库里策略对应的权限更新了是无法感知到的.

上面两点是值令牌的缺陷, 或许你会想那无脑用引用令牌好了, 但其实有些场景下还得考虑一点: 前后端分离下其实我们已经不需要考虑页面的权限了, 但这两年 nodejs 生态下 SSR 又非常流行, 放在 Storage 的令牌又带不过去

说到底, 我觉得在令牌授权这方面, 已经是矫枉过正了, 在各种博客平台上时不时就会出现一篇初学者写的登录方案解析, 写着自己都似懂非懂的优势劣势,
大量低素质的开发人员只听说过 JWT 和 Cookie, 却又不了解其中原理和应用场景, 以至于在实践中瞎用, 当然了, 这又和我有什么关系呢,
我不过是恰好拿着马桶搋子路过而已
