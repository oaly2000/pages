---
title: 不要以SPA的思路来写服务端渲染
date: 2024-04-24
tags:
  - SSR
---

去年下半年, 我第一次跑出了 fresh 的 hello world, deno、零客户端js这两个特性一下就吸引了我, 于是我花了很长时间研究服务端渲染相关的内容,
过程中是踩坑无数.

1. 组件库的选用

    组件库这个东西对前端程序员或者有过前后端一把梭经验的后端来讲都不陌生, 画页面要是没有组件库, 那还画个锤子啊.

    理所当然, 我也要选一个组件库用, fresh 是基于 preact 的, 那么就在 react 组件库里挑选吧, 我选择的是 fluent ui, 微软的的设计很有“特色”,
    不过颜值归颜值, 在功能性和 API 设计这一块, 我觉得这个库还是比较强的.

    然后我就愣住了, 类型不兼容, 我忍了, 反正我写 demo 无所谓, 但页面刚渲染时会出现闪烁, 这个问题就大了, 一看资源, 好家伙, `island-fluent.js`
    这个文件 11MB, 这明显是没有 tree-shake. 我当时花了挺长时间试图解决这个问题, 但最终我看着某个元素上奇形怪状的类名, 我知道, 我是在做无用功,
    css-in-js 方案下, 组件库代码尺寸巨大是一定的, 即使 tree-shake 了也好不了多少.

    后来一个小项目我是用 fresh 交付的, 这次, 我没有在用任何组件库, tailwindcss便是我用到的一切, 每个页面加载资源不过数十 KB, 体验非常流畅.

2. 杀🐷焉用水果刀

    这些个 meta-framework 的好处就是他是完整的框架, 不需要像之前写 react 那样攒库, 于是我便想着是否能够统统用这些框架来写所有前端应用,
    去你妈的客户端渲染.

    显然我最后失败了, 我尝试过 fresh、 remix、 next, 某些库的服务端渲染兼容性不说, 一个要命的问题是, 很多代码似乎必须在客户端跑,
    于是就出现了一个问题, 客户端运行时代码似乎也没怎么减少, 还要额外部署一个 node/deno 来跑前端项目, 更重要的是,
    我还要去兼容这些并不怎么好用的框架, 于是我就放弃了.

    回头一想, 服务端渲染是什么场景? 官网、小独立站、博客, 都是颇为简单的应用, 真拿服务端渲染来写复杂表单, 搞管理系统, 那不是自找苦吃吗.

3. 复古

    当我再一次准备搭建博客的时候, 我第一反应就是用 fresh, 种种优点懒得解释, 但主题这个东西有点麻烦, tailwind 写两个配色是非常痛苦的, 我想到了
    css var, 想到了 bootstrap, 想到了那些个 css 组件库, 于是我选用 daisyui, 一个基于 tailwind 的 css 样式库, 我是在写服务端渲染,
    这本就不是一件时髦的事, 那么干脆就复古用回 css 库吧, 什么 headless ui 啥啥的, 对不起, 我不写 js.

最后回想, 作为一个入行较晚的前端, 我潜意识中已习惯了 SPA 的开发方式, 种种坑全都是由此而来, 哎, 凡事啊, 不要想当然.
